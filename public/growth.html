<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>Growth Center (æˆé•¿ä¸­å¿ƒ)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #0f0f1a; color: white; padding-bottom: 5rem; }
    .header { background: #1a1a2e; padding: 1.5rem; text-align: center; border-bottom: 1px solid #333; }
    .container { max-width: 800px; margin: 1rem auto; padding: 0 1rem; }
    .card { background: #1a1a2e; border-radius: 15px; padding: 1.5rem; margin-bottom: 1.5rem; border: 1px solid rgba(255,255,255,0.1); }
    .c-title { color:#4facfe; font-size:1.2rem; font-weight:bold; margin-bottom:1rem; border-left: 4px solid #e94560; padding-left: 10px; }
    
    /* Chart Area */
    .chart-area { background: #2a2a4a; padding: 20px; border-radius: 12px; margin-bottom: 15px; }
    #radarBox { width: 100%; height: 300px; margin: 0 auto; }
    
    /* Progress Bars */
    .progress-item { margin-bottom:12px; }
    .p-label { display:flex; justify-content:space-between; font-size:0.9rem; margin-bottom:4px; color:#ccc }
    .p-track { background:#0f3460; height:8px; border-radius:4px; overflow:hidden}
    .p-fill { height:100%; background:#2ed573; border-radius:4px}
    
    /* Recommendations */
    .rec-card { background:#16213e; padding:15px; border-radius:8px; border-left: 4px solid #ff9966; margin-top:10px; }
    .rec-title { color:#ff9966; font-weight:bold; margin-bottom:5px; }
    .rec-reason { font-size:0.85rem; color:#ccc; }

    /* Nav */
    .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #16213e; border-top: 1px solid #333; display: flex; justify-content: space-around; padding: 8px 0; z-index: 99; padding-bottom: max(8px, env(safe-area-inset-bottom)); }
    .nav-item { text-decoration: none; color: #888; font-size: 0.75rem; text-align: center; flex: 1; }
    .nav-icon { font-size: 1.4rem; margin-bottom: 2px; display: block; }
    .nav-item.active { color: #e94560; }
  </style>
</head>
<body>

<div class="header"><h2>ğŸš€ Growth Center (æˆé•¿æ¡£æ¡ˆ)</h2></div>
<div class="container">
    <div class="card">
        <div class="c-title">å…­ç»´åº¦èƒ½åŠ›è¯„ä¼° (Abilities Radar)</div>
        <div class="chart-area">
            <div id="radarBox">
                <canvas id="abilitiesChart"></canvas>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="c-title">â³ ç»éªŒç§¯ç´¯ä¸è¯¾æ—¶ç»Ÿè®¡</div>
        <div id="progressStats">Loading data...</div>
        <div style="margin-top:15px; border-top:1px solid #333; padding-top:15px">
            <div class="c-title" style="margin-bottom:5px; border-left:4px solid #4facfe;">ğŸ’¡ è¯¾ç¨‹æ¨è (Based on low stats)</div>
            <div id="recommendations">No specific recommendations yet.</div>
        </div>
    </div>
    
    <div class="card">
        <div class="c-title">ğŸ“Œ æ´»åŠ¨ä»»åŠ¡ (Quests)</div>
        <div style="color:#ccc; font-size:0.9rem">Attend the New Year Show (Experience +10).</div>
    </div>

</div>

<div class="nav-bar">
    <a href="/games.html" class="nav-item"><span class="nav-icon">ğŸ®</span>Hub</a>
    <a href="/my_schedule.html" class="nav-item"><span class="nav-icon">ğŸ“…</span>Schedule</a>
    <a href="/timetable.html" class="nav-item"><span class="nav-icon">ğŸ›’</span>Market</a>
    <a href="/rooms.html" class="nav-item"><span class="nav-icon">ğŸ”‘</span>Rooms</a>
</div>

<script>
    async function loadData() {
        try {
            const res = await fetch('/api/my-progress');
            const data = await res.json();
            
            if (!data.success) {
                 document.getElementById('progressStats').innerHTML = '<div style="color:red">Failed to load data. Please log in again.</div>';
                 return;
            }
            
            // 1. Render Radar Chart
            renderRadar(data.stats);

            // 2. Render Progress Bars
            renderProgress(data.progress);
            
            // 3. Render Recommendations (Mock logic)
            renderRecommendations(data.stats);

        } catch (e) {
            document.getElementById('progressStats').innerHTML = '<div style="color:red">Error connecting to server.</div>';
        }
    }

    function renderRadar(stats) {
        const ctx = document.getElementById('abilitiesChart');
        if (!ctx) return;
        
        const labels = ['æŸ”éŸ§åº¦ (Flex)', 'åŠ›é‡ (Str)', 'èŠ‚å¥ (Rhythm)', 'è®°å¿† (Mem)', 'æŠ€å·§ (Tech)', 'å‹¤å¥‹åº¦ (Ded)'];
        const dataValues = [
            stats.flexibility, stats.strength, stats.stats.rhythm, 
            stats.memory, stats.technique, stats.dedication
        ];

        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Current Ability',
                    data: dataValues,
                    backgroundColor: 'rgba(233, 69, 96, 0.4)',
                    borderColor: '#e94560',
                    pointBackgroundColor: '#fff',
                    borderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: { color: 'rgba(255,255,255,0.1)' },
                        grid: { color: 'rgba(255,255,255,0.1)' },
                        pointLabels: { color: '#ccc', font: {size: 10} },
                        suggestedMin: 0,
                        suggestedMax: 100,
                        ticks: { display: false }
                    }
                },
                plugins: { legend: { display: false } }
            }
        });
    }

    function renderProgress(progressData) {
        const statsDiv = document.getElementById('progressStats');
        statsDiv.innerHTML = '';
        if (progressData.length === 0) {
            statsDiv.innerHTML = '<div style="color:#888">No attendance records yet.</div>';
            return;
        }

        progressData.forEach(p => {
            const hours = p.cumulative_hours.toFixed(1);
            const target = p.course_category.includes('RAD') || p.course_category.includes('NZAMD') ? 30 : 20; // è€ƒè¯•è¯¾ç¨‹ç›®æ ‡æ›´é«˜
            const percent = Math.min(100, (hours / target) * 100);
            
            statsDiv.innerHTML += `
                <div class="progress-item">
                    <div class="p-label">
                        <span>${p.course_category} (Hours for Exam)</span> 
                        <span>${hours}/${target}h</span>
                    </div>
                    <div class="p-track">
                        <div class="p-fill" style="width:${percent}%"></div>
                    </div>
                </div>`;
        });
    }

    function renderRecommendations(stats) {
        // Mock recommendation: If Flexibility is low (<40), recommend a stretch class
        if (stats.flexibility < 40) {
            document.getElementById('recommendations').innerHTML = `
                <div class="rec-card">
                    <div class="rec-title">FLEXIBILITY CORE & ACRO (è½¯å¼€æ ¸å¿ƒ)</div>
                    <div class="rec-reason">Your Flexibility score is low (${stats.flexibility}/100). This class is crucial for improving line and amplitude.</div>
                </div>
            `;
        } else {
             document.getElementById('recommendations').innerHTML = '<div style="color:#888">All core stats are good! Keep practicing.</div>';
        }
    }


    loadData();
</script>
</body>
</html>