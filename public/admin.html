<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Admin</title>
  <style>
    body{font-family:sans-serif;margin:0;background:#f2f4f8;padding-bottom:4rem}
    .header{background:#333;color:white;padding:1rem;position:sticky;top:0;z-index:100;display:flex;justify-content:space-between}
    .nav-tab{cursor:pointer;opacity:0.7;font-weight:bold}
    .nav-tab.active{opacity:1;border-bottom:2px solid white}
    .container{padding:15px}
    .class-card{background:white;padding:15px;margin-bottom:10px;border-radius:8px}
    
    /* ÂÆ°Ê†∏Âç°Áâá */
    .review-card{background:white;padding:15px;margin-bottom:15px;border-radius:8px}
    .r-img{width:100%;height:200px;object-fit:contain;background:#eee;margin:10px 0}
    .btn-row{display:flex;gap:10px;margin-top:10px}
    .btn{flex:1;padding:10px;border:none;border-radius:5px;cursor:pointer;font-weight:bold}
    .btn-gold{background:#ffd700} .btn-silver{background:#c0c0c0} .btn-bronze{background:#cd7f32;color:white} .btn-reject{background:#ff4757;color:white}
  </style>
</head>
<body>

<div class="header">
  <div>Admin</div>
  <div style="display:flex;gap:20px">
    <div class="nav-tab active" onclick="switchTab('classes')">Classes</div>
    <div class="nav-tab" onclick="switchTab('reviews')">Trophies</div>
  </div>
</div>

<div id="tabClasses" class="container">
    <div id="classList">Loading...</div>
</div>

<div id="tabReviews" class="container" style="display:none">
    <div id="pendingList">Loading...</div>
</div>

<script>
  function switchTab(t) {
      document.getElementById('tabClasses').style.display = t==='classes'?'block':'none';
      document.getElementById('tabReviews').style.display = t==='reviews'?'block':'none';
      if(t==='reviews') loadPending();
      else loadClasses();
  }

  // 1. ËØæË°®ÈÄªËæë (ÁÆÄÂåñÁâà)
  async function loadClasses() {
      const res = await fetch('/api/teacher/schedule');
      const data = await res.json();
      const list = document.getElementById('classList');
      list.innerHTML = '';
      data.forEach(c => {
          list.innerHTML += `<div class="class-card"><b>${c.name}</b><br>${c.day_of_week} ${c.start_time} (${c.student_count}‰∫∫)</div>`;
      });
  }

  // 2. ÂÆ°Ê†∏ÈÄªËæë
  async function loadPending() {
      const res = await fetch('/api/admin/trophies/pending');
      const data = await res.json();
      const list = document.getElementById('pendingList');
      list.innerHTML = '';
      if(data.length===0) list.innerHTML='No pending items';
      
      data.forEach(item => {
          list.innerHTML += `
            <div class="review-card">
                <div>Student: <b>${item.student_name}</b></div>
                <img src="${item.image_path}" class="r-img">
                <div class="btn-row">
                    <button class="btn btn-gold" onclick="audit(${item.id}, 'gold')">ü•á Gold</button>
                    <button class="btn btn-silver" onclick="audit(${item.id}, 'silver')">ü•à Silver</button>
                    <button class="btn btn-bronze" onclick="audit(${item.id}, 'bronze')">ü•â Bronze</button>
                    <button class="btn btn-reject" onclick="audit(${item.id}, 'reject')">‚ùå Reject</button>
                </div>
            </div>
          `;
      });
  }

  async function audit(id, type) {
      const action = type === 'reject' ? 'reject' : 'approve';
      const name = action === 'approve' ? prompt("Award Name (e.g. RAD G1):", "Certificate") : "";
      if(action==='approve' && !name) return;

      await fetch('/api/admin/trophies/approve', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ trophyId: id, action, type, sourceName: name })
      });
      alert('Done');
      loadPending();
  }
  
  loadClasses();
</script>
</body>
</html>